#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export PATH="$SCRIPT_DIR:$PATH"

if [ -z ${FLUDSTART} ]; then
    i=1
else
    i=${FLUDSTART}
fi

NODES=${1:-1}

pids=""

if [[ "$NODES" =~ ^[0-9]+-[0-9]+$ ]]; then
    seqstart=${NODES%-*}
    seqend=${NODES#*-}
else
    seqstart=$i
    seqend=$((NODES + i - 1))
fi

for i in `seq $seqstart $seqend`; do
    export FLUDHOME="${HOME}/.flud${i}"
    pidfile="$FLUDHOME/twistd.pid"
    if [ -f "$pidfile" ]; then
        pids="$pids $(cat "$pidfile")"
    fi
done

if [ -n "$pids" ]; then
    echo "killing $pids"
    kill $pids
fi
